<%- include('header') -%>
<%- include('sidebar') -%>

<link rel="stylesheet" href="css/editprofile.css">

<div class="notSidebar">

    <div class="greeting-profile">
        <h2> User Profile </h2>
    </div>

    <div class="info">
        <h3> Name: <%= user.name %> </h3>
        <h3> Description: </h3>

        <input type="text" id="descriptionInput" name="description" value=" <%= user.description %>" readonly>
        
        
        <h3><a href="/reserve">Current Reservations: </a></h3>
            
        <!-- List view box for current reservations -->

        <div class="current-reservations">
            <table>
                <thead>
                    <tr>
                        <th>Lab</th>
                        <th>Seat</th>
                        <th>Date</th>
                        <th>Start Time</th>
                        <th>End Time</th>
                        <th>Reservation Name</th>
                    </tr>
                </thead>
                <tbody>
                    <% for (const reservationId in user.reservations) { %>
                        <% const reservation = user.reservations[reservationId]; %>
                        <tr>
                            <td><%= reservation.lab %></td>
                            <td><%= reservation.seat %></td>
                            <td><%= reservation.date %></td>
                            <td><%= reservation.time %> <%= reservation.AMPM %></td>
                            <!-- Calculate End Time based on Start Time and Duration -->
                            <td><%= reservation.end_time %> <%= reservation.end_AMPM %></td>
                            <td><%= reservation.res_name %></td>
                        </tr>
                    <% } %>
                   
                </tbody>
            </table>
        </div>

    </div>

    <div class="image-container-profile">
        <img src="assets/jeongwoo.jpg" alt="userpfp" id="userpfp"> <br> <br>
    </div>

    <div class="profile-buttons">
        <button onclick="navigateTo('/edittprofile')" class="profile-button">Edit Profile</button>
        <button class="profile-button">Change Password</button>
        <button onclick="navigateTo('/')" class="profile-button">Logout</button>
        <button class="profile-button red-text">Delete Account</button>
    </div>
       
</div>

<%- include('footer') -%>

<script>
    function navigateTo(url) {
        window.location.href = url;
    }

    function calculateEndTime(startTime, duration, AMPM) {
        // Split the startTime string into hours and minutes
        const [startHour, startMinute] = startTime.split(':').map(Number);
        
        // Convert startTime to 24-hour format
        let hour = startHour;
        if (AMPM === 'PM' && startHour !== 12) {
            hour += 12;
        } else if (AMPM === 'AM' && startHour === 12) {
            hour = 0;
        }
        
        // Calculate total minutes from startTime
        let totalMinutes = hour * 60 + startMinute;
        
        // Add duration in terms of 30-minute units
        totalMinutes += duration * 30;
        
        // Calculate end hour and minute
        const endHour = Math.floor(totalMinutes / 60) % 24;
        const endMinute = totalMinutes % 60;
        
        // Convert end hour to 12-hour format
        const formattedHour = (endHour % 12 === 0) ? 12 : endHour % 12;
        
        // Determine AM/PM for end time
        const formattedAMPM = endHour < 12 ? 'AM' : 'PM';
        
        // Format end time as a string
        const endTime = `${formattedHour}:${endMinute.toString().padStart(2, '0')} ${formattedAMPM}`;
        
        return endTime;
    }
    
    // Example usage
    const startTime = '10:00';
    const duration = 1; // Assuming 1 unit of duration is 30 minutes
    const AMPM = 'AM';
    
    const endTime = calculateEndTime(startTime, duration, AMPM);
    console.log(endTime); // Output: 10:30 AM
    
</script>
