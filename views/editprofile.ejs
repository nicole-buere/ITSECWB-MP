<%- include('header') -%>
<%- include('sidebar') -%>

<link rel="stylesheet" href="css/editprofile.css">

<div class="notSidebar">

    <div class="greeting-profile">
        <h2> User Profile </h2>
    </div>

    <div class="info">
        <h3> Name: <%= username %> </h3>
        <h3> Description: </h3>

        <!-- Display the description -->
        <input type="text" id="descriptionInput" name="description" value="<%= description %>" readonly>
        
        <h3><a href="/reserve">Current Reservations: </a></h3>
            
        <!-- List view box for current reservations -->

        <div class="current-reservations">
            <table>
                <thead>
                    <tr>
                        <th>Lab</th>
                        <th>Seat</th>
                        <th>Date</th>
                        <th>Start Time</th>
                        <th>End Time</th>
                        <th>Reservation Name</th>
                    </tr>
                </thead>
                <tbody>
                    <% for (const reservationId in user.reservations) { %>
                        <% const reservation = user.reservations[reservationId]; %>
                        <tr>
                            <td><%= reservation.lab %></td>
                            <td><%= reservation.seat %></td>
                            <td><%= reservation.date %></td>
                            <td><%= reservation.time %> <%= reservation.AMPM %></td>
                            <!-- Calculate End Time based on Start Time and Duration -->
                            <td><%= reservation.end_time %> <%= reservation.end_AMPM %></td>
                            <td><%= reservation.res_name %></td>
                        </tr>
                    <% } %>
                   
                </tbody>
            </table>
        </div>

    </div>

    <div class="image-container-profile">
        <img src="<%= user.pictureURL %>" alt="userpfp" id="userpfp"> <br> <br>
    </div>

    <div class="profile-buttons">
        <button onclick="navigateTo('/edittprofile')" class="profile-button">Edit Profile</button>
        <button class="profile-button" id="changePasswordButton">Change Password</button>

        <div id="passwordChangeModal" class="modal" style="display: none;">
            <div class="modal-content">
                <span class="close" id="closePasswordChangeModal">&times;</span>
                <div class="input-container">
                    <input type="password" id="newPasswordInput" placeholder="Enter new password">
                </div>
                <div class="input-container">
                    <input type="password" id="confirmNewPasswordInput" placeholder="Re-enter new password">
                </div>
                <div class="button-container">
                    <button id="confirmPasswordChangeButton">Confirm</button>
                    <button id="cancelPasswordChangeButton">Cancel</button>
                </div>
            </div>
        </div>
        
        

                
        <button onclick="navigateTo('/')" class="profile-button">Logout</button>
        <button class="profile-button red-text" id="deleteAccountButton">Delete Account</button>
    </div>
       
</div>

<%- include('footer') -%>

<script>
    function navigateTo(url) {
        window.location.href = url;
    }

    // Get a reference to the button
    const deleteAccountButton = document.getElementById("deleteAccountButton");

    // Add event listener to the button
    deleteAccountButton.addEventListener("click", function() {
        // Show the confirmation dialog
        const confirmed = confirm("Are you sure you want to delete your account? This action cannot be undone.");

        // If the user confirms, proceed with account deletion
        if (confirmed) {
            alert("Your account has been deleted."); // Temporary alert for demonstration
        } else {
           alert("Account deletion canceled.");
        }
    });

    const changePasswordButton = document.getElementById("changePasswordButton");
    const passwordChangeModal = document.getElementById("passwordChangeModal");
    const newPasswordInput = document.getElementById("newPasswordInput");
    const confirmPasswordChangeButton = document.getElementById("confirmPasswordChangeButton");
    const cancelPasswordChangeButton = document.getElementById("cancelPasswordChangeButton");
    const closePasswordChangeModal = document.getElementById("closePasswordChangeModal");

    changePasswordButton.addEventListener("click", function() {
        passwordChangeModal.style.display = "block";
    });

    closePasswordChangeModal.addEventListener("click", function() {
        passwordChangeModal.style.display = "none";
    });

    cancelPasswordChangeButton.addEventListener("click", function() {
        passwordChangeModal.style.display = "none";
    });

    confirmPasswordChangeButton.addEventListener("click", function() {
        const newPassword = newPasswordInput.value;
        if (newPassword.trim() === "") {
            alert("Please enter a valid password.");
            return;
        }
        // Here you can perform password change logic
        // For demonstration, we're just showing an alert
        alert("Password changed successfully.");
        passwordChangeModal.style.display = "none";
        // You can also clear the input field if needed
        newPasswordInput.value = "";
    });
    


</script>
